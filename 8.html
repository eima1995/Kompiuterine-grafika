<!DOCTYPE html>
<html>
<head>
</head>
  <body>
    <canvas id="myCanvas" width="1200" height="1000"></canvas>
    <script>
      window.requestAnimFrame = (function(callback) {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
        function(callback) {
          window.setTimeout(callback, 1000 / 60);
        };
      })();
      function draw(myLink, ctx) {
        ctx.beginPath();
        ctx.rect(-myLink.off, -myLink.off, myLink.width+2*myLink.off, 2*myLink.off);
        ctx.fillStyle = myLink.color;
        ctx.fill();
        ctx.lineWidth = myLink.borderWidth;
        ctx.strokeStyle = 'black';
        ctx.stroke();
        ctx.beginPath();        
        ctx.arc(0,0,myLink.borderWidth/2,0,Math.PI*2,true);
        ctx.fillStyle = 'white';
        ctx.fill();
        ctx.beginPath();        
        ctx.arc(myLink.width,0,myLink.borderWidth/2,0,Math.PI*2,true);
        ctx.fillStyle = 'white';
        ctx.fill();
      }
      function animate(aLink, bLink, cLink, dLink, efLink,beLink, ceLink, bfLink, canvas, ctx, startTime) {
		var time = (new Date()).getTime() - startTime;
        var t = time / 10;
        // if (Math.floor((t/360))%2==1) {
        //   t=-t;
        // }


        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save(); // [M0]

        ctx.translate(canvas.width/2, canvas.height/2);
		ctx.save();  // [M1,M0]
	    
        alfa = - Math.PI/180*t; // kad, kita puse suktusi
		ctx.rotate(alfa);
        draw(bLink, ctx);
		
		var AC = Math.sqrt(cLink.width*cLink.width + bLink.width*bLink.width - 2*cLink.width*bLink.width*Math.cos(Math.PI - alfa));
		var theta = Math.acos((AC*AC + cLink.width*cLink.width - bLink.width*bLink.width)/(2*AC*cLink.width));
		

        
		
        ctx.restore(); // M1 [M0]
		ctx.translate(-cLink.width,0);
		draw(cLink, ctx) //AD
		
		if(((Math.PI/180*t)%(Math.PI*2)) < Math.PI){
			console.log("Virsus" + alfa);
			ctx.rotate(-theta);
		    dLink.width = AC; // galim priskirti kadangi, niekam nera priskirtas
			draw(dLink, ctx);
        }else{
			ctx.rotate(theta);
		    dLink.width = AC; // galim priskirti kadangi, niekam nera priskirtas
			draw(dLink, ctx);
			console.log("Apacia" + alfa);
		}
		
		///mintis cia kabinti visas likusias dalis
		
		
		
       
        ctx.restore(); // M0 [] //pradzios koordinates grazinamos
		;
        // request new frame
        requestAnimFrame(function() {
          animate(aLink, bLink, cLink, dLink, efLink, beLink, ceLink, bfLink, canvas, ctx, startTime);
        });
      }
      var canvas = document.getElementById('myCanvas');
      var ctx = canvas.getContext('2d');
      var aLink = {  // AB, BC
        color: '#8ED6FF',
        width: 200,
        off: 10,
        borderWidth: 4
      };
      var bLink = { // CD
        color: '#FF8ED6',
        width: 250,
        off: 10,
        borderWidth: 4
      };
	  
	  var cLink = { // AD
        color: 'green',
        width: 150,
        off: 10,
        borderWidth: 4
      };
      var dLink = { // AC
		color: 'cyan',
		width: 100,
		off: 10,
       borderWidth: 4
      };
	  
	  var bfLink = { // BF
		color: 'cyan',
		width: 100,
		off: 10,
       borderWidth: 4
      };
	  
	  
	  var efLink = { // EF
		color: 'cyan',
		width: 200,
		off: 10,
       borderWidth: 4
      };
	  
	 var beLink = { // BE
		color: 'cyan',
		width: 100,
		off: 10,
       borderWidth: 4
      };
	 
	var ceLink = { // CE
		color: 'cyan',
		width: 100,
	    off: 10,
       borderWidth: 4
      };
	  
      //draw(myLink, ctx);
      // wait one second before starting animation
//      setTimeout(function() {
        var startTime = (new Date()).getTime();
        animate(aLink, bLink, cLink, dLink, efLink, beLink, ceLink, bfLink, canvas, ctx, startTime);
//      }, 1000);
    </script>
</body>
</html>
